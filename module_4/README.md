## Технические задания к модулю 4  

#### 1. [Работа с PostgreSQL](https://github.com/to-the-DE/my_internship/blob/main/module_4/hw_module_4_pg.sql)  

- Создайте функцию логирования изменений по трем полям.  
- Создайте trigger на таблицу users.    
- Установите расширение pg_cron.  
- Создайте функцию, которая будет доставать только свежие данные (за сегодняшний день) и будет сохранять их в образе Docker по пути /tmp/users_audit_export_, а далее указываете ту дату, за который этот csv был создан.  
- Установите планировщик pg_cron на 3:00 ночи.  

#### 2. [Работа с Clickhouse](https://github.com/to-the-DE/my_internship/blob/main/module_4/hw_module_4_click.sql)  

 - Поддерживать сырые логи событий (схема выше). Обратите внимание на то, что данные в этой таблице должны хранится 30 дней.  
 - Построить агрегированную таблицу. Храним агрегаты 180 дней, чтобы делать трендовый анализ:  
   - уникальные пользователи по event_type и event_date  
   - сумма потраченных баллов  
   - количество действий  
 - Сделать Materialized View, которая:  
   - при вставке данных в таблицу сырых логов событий, будет обновлять агрегированную таблицу  
   - использует sumState, uniqState, countState  
 - Создать запрос, показывающий:  
   - Retention: сколько пользователей вернулись в течение следующих 7 дней. Формат результата - total_users_day_0|returned_in_7_days|retention_7d_percent|  
 - Создать запрос с группировками по быстрой аналитике по дням  

#### 3. [Работа с NoSQL](https://github.com/to-the-DE/my_internship/blob/main/module_4/hw_module_4_no_sql.py)  
Требуется:  
 - Ежедневно находить пользователей, которые:  
   - Зарегистрировались более 30 дней назад  
   - И не проявляли активности последние 14 дней  
 - Перемещать этих пользователей в архивную коллекцию archived_users  
 - Сохранять отчёт в формате [.json](https://github.com/to-the-DE/my_internship/blob/main/module_4/2025-07-09.json) о количестве пользователей, архивированных в этот день. Автоматизация через cron не нужна, запуск скрипта - ручной, ежедневный. Используйте только pymongo, json, os и datetime.